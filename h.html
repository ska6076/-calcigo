<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Loan EMI Calculator</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h1,
        h2 {
            text-align: center;
        }

        .inputs {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin: 10px 0 5px;
        }

        input[type="number"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #218838;
        }

        .outputs {
            margin: 20px 0;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>EMI for your <span>Home</span> Loan</h1>
        <div class="inputs">
            <label for="principal">Principal Amount (₹):</label>
            <input type="number" id="principal" step="0.01" placeholder="Enter principal amount" required>

            <label for="interest">Annual Rate of Interest (%):</label>
            <input type="number" id="interest" step="0.01" placeholder="Enter interest rate" required>

            <label for="tenure">Tenure (Years):</label>
            <input type="number" id="tenure" value="15" min="1" required>
            <label><input type="checkbox" id="tenureCheckbox"> Switch to Months</label>

            <div id="otherChargesSection" class="hidden">
                <label for="otherCharges">Other Charges (₹):</label>
                <input type="number" id="otherCharges" step="0.01" placeholder="Enter other charges">
            </div>
            <label><input type="checkbox" id="otherChargesCheckbox"> Include Other Charges</label>

            <label><input type="checkbox" id="reducingRateCheckbox"> Reducing Rate of Interest</label>

            <button id="calculateBtn">Calculate EMI</button>
        </div>

        <div class="outputs">
            <h2>Total Amount Payable: <span id="totalPayable">₹0.00</span></h2>
            <h2>Total Interest: <span id="totalInterest">₹0.00</span></h2>
            <h2>Total Interest (% of Principal): <span id="totalInterestPercentage">0.00%</span></h2>
        </div>

        <table id="resultsTable">
            <thead>
                <tr>
                    <th>Months</th>
                    <th>Opening Principal</th>
                    <th>EMI</th>
                    <th>Principal (part of EMI)</th>
                    <th>Monthly Interest</th>
                    <th>Closing Principal</th>
                </tr>
            </thead>
            <tbody>
                <!-- Results will be populated here -->
            </tbody>
        </table>
    </div>

    <script>
        document.getElementById('calculateBtn').addEventListener('click', calculateEMI);
        document.getElementById('otherChargesCheckbox').addEventListener('change', toggleOtherCharges);
        document.getElementById('tenureCheckbox').addEventListener('change', toggleTenure);

        function toggleOtherCharges() {
            const otherChargesSection = document.getElementById('otherChargesSection');
            otherChargesSection.classList.toggle('hidden', !this.checked);
        }

        function toggleTenure() {
            const tenureInput = document.getElementById('tenure');
            if (this.checked) {
                tenureInput.value = tenureInput.value * 12; // Convert years to months
                tenureInput.setAttribute('max', 360); // Set max to 30 years in months
            } else {
                tenureInput.value = Math.ceil(tenureInput.value / 12); // Convert months to years
                tenureInput.setAttribute('max', 30); // Set max to 30 years
            }
        }

        function calculateEMI() {
            const principal = parseFloat(document.getElementById('principal').value);
            const annualInterest = parseFloat(document.getElementById('interest').value);
            const tenure = parseInt(document.getElementById('tenure').value);
            const otherCharges = document.getElementById('otherChargesCheckbox').checked ? parseFloat(document.getElementById('otherCharges').value) || 0 : 0;
            const isReducingRate = document.getElementById('reducingRateCheckbox').checked;

            const monthlyInterestRate = (annualInterest / 100) / 12;
            const totalMonths = document.getElementById('tenureCheckbox').checked ? tenure : tenure * 12;

            let emi, totalInterest, totalPayable;

            if (isReducingRate) {
                emi = (principal * monthlyInterestRate * Math.pow(1 + monthlyInterestRate, totalMonths)) / (Math.pow(1 + monthlyInterestRate, totalMonths) - 1);
                totalPayable = emi * totalMonths;
                totalInterest = totalPayable - principal;
            } else {
                emi = (principal * (annualInterest / 100) / 12) + (principal / totalMonths);
                totalPayable = emi * totalMonths;
                totalInterest = totalPayable - principal;
            }

            totalInterest += otherCharges;

            document.getElementById('totalPayable').innerText = `₹${totalPayable.toFixed(2)}`;
            document.getElementById('totalInterest').innerText = `₹${totalInterest.toFixed(2)}`;
            document.getElementById('totalInterestPercentage').innerText = `${((totalInterest / principal) * 100).toFixed(2)}%`;

            updateResultsTable(totalMonths, principal, emi, monthlyInterestRate, isReducingRate);
        }

        function updateResultsTable(totalMonths, principal, emi, monthlyInterestRate, isReducingRate) {
            const resultsTableBody = document.getElementById('resultsTable').getElementsByTagName('tbody')[0];
            resultsTableBody.innerHTML = ''; // Clear previous results

            let openingPrincipal = principal;

            for (let month = 1; month <= totalMonths; month++) {
                let monthlyInterest = openingPrincipal * monthlyInterestRate;
                let principalPart = emi - monthlyInterest;
                let closingPrincipal = openingPrincipal - principalPart;

                if (closingPrincipal < 0) closingPrincipal = 0; // Prevent negative closing principal

                const row = resultsTableBody.insertRow();
                row.insertCell(0).innerText = month;
                row.insertCell(1).innerText = `₹${openingPrincipal.toFixed(2)}`;
                row.insertCell(2).innerText = `₹${emi.toFixed(2)}`;
                row.insertCell(3).innerText = `₹${principalPart.toFixed(2)}`;
                row.insertCell(4).innerText = `₹${monthlyInterest.toFixed(2)}`;
                row.insertCell(5).innerText = `₹${closingPrincipal.toFixed(2)}`;

                openingPrincipal = closingPrincipal; // Update opening principal for next month
            }
        }

    </script>
</body>

</html>